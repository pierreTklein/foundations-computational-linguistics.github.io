_site/assets/js/webchurch.min.js:var match=matching[ch];if(match.charAt(1)==">"==dir>0)stack.push(ch);else if(!stack.length)return{pos:Pos(lineNo,pos),ch:ch};else stack.pop()}}}return lineNo-dir==(dir>0?cm.lastLine():cm.firstLine())?false:null}function matchBrackets(cm,autoclear,config){var maxHighlightLen=cm.state.matchBrackets.maxHighlightLineLength||1e3;var marks=[],ranges=cm.listSelections();for(var i=0;i<ranges.length;i++){var match=ranges[i].empty()&&findMatchingBracket(cm,ranges[i].head,false,config);if(match&&cm.getLine(match.from.line).length<=maxHighlightLen){var style=match.match?"CodeMirror-matchingbracket":"CodeMirror-nonmatchingbracket";marks.push(cm.markText(match.from,Pos(match.from.line,match.from.ch+1),{className:style}));if(match.to&&cm.getLine(match.to.line).length<=maxHighlightLen)marks.push(cm.markText(match.to,Pos(match.to.line,match.to.ch+1),{className:style}))}}if(marks.length){if(ie_lt8&&cm.state.focused)cm.display.input.focus();var clear=function(){cm.operation(function(){for(var i=0;i<marks.length;i++)marks[i].clear()})};if(autoclear)setTimeout(clear,800);else return clear}}var currentlyHighlighted=null;function doMatchBrackets(cm){cm.operation(function(){if(currentlyHighlighted){currentlyHighlighted();currentlyHighlighted=null}currentlyHighlighted=matchBrackets(cm,false,cm.state.matchBrackets)})}CodeMirror.defineOption("matchBrackets",false,function(cm,val,old){if(old&&old!=CodeMirror.Init)cm.off("cursorActivity",doMatchBrackets);if(val){cm.state.matchBrackets=typeof val=="object"?val:{};cm.on("cursorActivity",doMatchBrackets)}});CodeMirror.defineExtension("matchBrackets",function(){matchBrackets(this,true)});CodeMirror.defineExtension("findMatchingBracket",function(pos,strict,config){return findMatchingBracket(this,pos,strict,config)});CodeMirror.defineExtension("scanForBracket",function(pos,dir,style,config){return scanForBracket(this,pos,dir,style,config)})})()}).call(this,require("/Users/timo/Documents/teaching/webchurch/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),typeof self!=="undefined"?self:typeof window!=="undefined"?window:{},require("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/cm-brackets.js","/")},{"/Users/timo/Documents/teaching/webchurch/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":28,buffer:19,codemirror:30}],"./cm-church":[function(require,module,exports){module.exports=require("lO4o+E")},{}],"lO4o+E":[function(require,module,exports){(function(process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){var CodeMirror=require("codemirror");CodeMirror.defineMode("scheme",function(){var BUILTIN="builtin",COMMENT="comment",STRING="string",ATOM="atom",NUMBER="number",BRACKET="bracket";var INDENT_WORD_SKIP=2;function makeKeywords(str){var obj={},words=str.split(" ");for(var i=0;i<words.length;++i)obj[words[i]]=true;return obj}var keywords=makeKeywords("λ case-lambda call/cc class define-class exit-handler field import inherit init-field interface let*-values let-values let/ec mixin opt-lambda override protect provide public rename require require-for-syntax syntax syntax-case syntax-error unit/sig unless when with-syntax and begin call-with-current-continuation call-with-input-file call-with-output-file case cond define define-syntax delay do dynamic-wind else for-each if lambda let let* let-syntax letrec letrec-syntax map or syntax-rules abs acos angle append apply asin assoc assq assv atan boolean? caar cadr call-with-values car cdddar cddddr cdr ceiling char->integer char-alphabetic? char-ci<=? char-ci<? char-ci=? char-ci>=? char-ci>? char-downcase char-lower-case? char-numeric? char-ready? char-upcase char-upper-case? char-whitespace? char<=? char<? char=? char>=? char>? char? close-input-port close-output-port complex? cons cos current-input-port current-output-port denominator display eof-object? eq? equal? eqv? eval even? exact->inexact exact? exp expt #f floor force gcd imag-part inexact->exact inexact? input-port? integer->char integer? interaction-environment lcm length list list->string list->vector list-ref list-tail list? load log magnitude make-polar make-rectangular make-string make-vector max member memq memv min modulo negative? newline not null-environment null? number->string number? numerator odd? open-input-file open-output-file output-port? pair? peek-char port? positive? procedure? quasiquote quote quotient rational? rationalize read read-char real-part real? remainder reverse round scheme-report-environment set! set-car! set-cdr! sin sqrt string string->list string->number string->symbol string-append string-ci<=? string-ci<? string-ci=? string-ci>=? string-ci>? string-copy string-fill! string-length string-ref string-set! string<=? string<? string=? string>=? string>? string? substring symbol->string symbol? #t tan transcript-off transcript-on truncate values vector vector->list vector-fill! vector-length vector-ref vector-set! with-input-from-file with-output-to-file write write-char zero? barplot enumeration-query rejection-query mh-query condition factor fold flatten pair first second third fourth fifth sixth seventh rest flip hist repeat gaussian density multiviz uniform-draw mem sum runPhysics animatePhysics uniform worldWidth worldHeight scatter lineplot dirichlet multinomial beta mean");var indentKeys=makeKeywords("define let letrec let* lambda");function stateStack(indent,type,prev){this.indent=indent;this.type=type;this.prev=prev}function pushStack(state,indent,type){state.indentStack=new stateStack(indent,type,state.indentStack)}function popStack(state){state.indentStack=state.indentStack.prev}var binaryMatcher=new RegExp(/^(?:[-+]i|[-+][01]+#*(?:\/[01]+#*)?i|[-+]?[01]+#*(?:\/[01]+#*)?@[-+]?[01]+#*(?:\/[01]+#*)?|[-+]?[01]+#*(?:\/[01]+#*)?[-+](?:[01]+#*(?:\/[01]+#*)?)?i|[-+]?[01]+#*(?:\/[01]+#*)?)(?=[()\s;"]|$)/i);var octalMatcher=new RegExp(/^(?:[-+]i|[-+][0-7]+#*(?:\/[0-7]+#*)?i|[-+]?[0-7]+#*(?:\/[0-7]+#*)?@[-+]?[0-7]+#*(?:\/[0-7]+#*)?|[-+]?[0-7]+#*(?:\/[0-7]+#*)?[-+](?:[0-7]+#*(?:\/[0-7]+#*)?)?i|[-+]?[0-7]+#*(?:\/[0-7]+#*)?)(?=[()\s;"]|$)/i);var hexMatcher=new RegExp(/^(?:[-+]i|[-+][\da-f]+#*(?:\/[\da-f]+#*)?i|[-+]?[\da-f]+#*(?:\/[\da-f]+#*)?@[-+]?[\da-f]+#*(?:\/[\da-f]+#*)?|[-+]?[\da-f]+#*(?:\/[\da-f]+#*)?[-+](?:[\da-f]+#*(?:\/[\da-f]+#*)?)?i|[-+]?[\da-f]+#*(?:\/[\da-f]+#*)?)(?=[()\s;"]|$)/i);var decimalMatcher=new RegExp(/^(?:[-+]i|[-+](?:(?:(?:\d+#+\.?#*|\d+\.\d*#*|\.\d+#*|\d+)(?:[esfdl][-+]?\d+)?)|\d+#*\/\d+#*)i|[-+]?(?:(?:(?:\d+#+\.?#*|\d+\.\d*#*|\.\d+#*|\d+)(?:[esfdl][-+]?\d+)?)|\d+#*\/\d+#*)@[-+]?(?:(?:(?:\d+#+\.?#*|\d+\.\d*#*|\.\d+#*|\d+)(?:[esfdl][-+]?\d+)?)|\d+#*\/\d+#*)|[-+]?(?:(?:(?:\d+#+\.?#*|\d+\.\d*#*|\.\d+#*|\d+)(?:[esfdl][-+]?\d+)?)|\d+#*\/\d+#*)[-+](?:(?:(?:\d+#+\.?#*|\d+\.\d*#*|\.\d+#*|\d+)(?:[esfdl][-+]?\d+)?)|\d+#*\/\d+#*)?i|(?:(?:(?:\d+#+\.?#*|\d+\.\d*#*|\.\d+#*|\d+)(?:[esfdl][-+]?\d+)?)|\d+#*\/\d+#*))(?=[()\s;"]|$)/i);function isBinaryNumber(stream){return stream.match(binaryMatcher)}function isOctalNumber(stream){return stream.match(octalMatcher)}function isDecimalNumber(stream,backup){if(backup===true){stream.backUp(1)}return stream.match(decimalMatcher)}function isHexNumber(stream){return stream.match(hexMatcher)}return{startState:function(){return{indentStack:null,indentation:0,mode:false,sExprComment:false}},token:function(stream,state){if(state.indentStack==null&&stream.sol()){state.indentation=stream.indentation()}if(stream.eatSpace()){return null}var returnType=null;switch(state.mode){case"string":var next,escaped=false;while((next=stream.next())!=null){if(next=='"'&&!escaped){state.mode=false;break}escaped=!escaped&&next=="\\"}returnType=STRING;break;case"comment":var next,maybeEnd=false;while((next=stream.next())!=null){if(next=="#"&&maybeEnd){state.mode=false;break}maybeEnd=next=="|"}returnType=COMMENT;break;case"s-expr-comment":state.mode=false;if(stream.peek()=="("||stream.peek()=="["){state.sExprComment=0}else{stream.eatWhile(/[^\/s]/);returnType=COMMENT;break}default:var ch=stream.next();if(ch=='"'){state.mode="string";returnType=STRING}else if(ch=="'"){returnType=ATOM}else if(ch=="#"){if(stream.eat("|")){state.mode="comment";returnType=COMMENT}else if(stream.eat(/[tf]/i)){returnType=ATOM}else if(stream.eat(";")){state.mode="s-expr-comment";returnType=COMMENT}else{var numTest=null,hasExactness=false,hasRadix=true;if(stream.eat(/[ei]/i)){hasExactness=true}else{stream.backUp(1)}if(stream.match(/^#b/i)){numTest=isBinaryNumber}else if(stream.match(/^#o/i)){numTest=isOctalNumber}else if(stream.match(/^#x/i)){numTest=isHexNumber}else if(stream.match(/^#d/i)){numTest=isDecimalNumber}else if(stream.match(/^[-+0-9.]/,false)){hasRadix=false;numTest=isDecimalNumber}else if(!hasExactness){stream.eat("#")}if(numTest!=null){if(hasRadix&&!hasExactness){stream.match(/^#[ei]/i)}if(numTest(stream))returnType=NUMBER}}}else if(/^[-+0-9.]/.test(ch)&&isDecimalNumber(stream,true)){returnType=NUMBER}else if(ch==";"){stream.skipToEnd();returnType=COMMENT}else if(ch=="("||ch=="["){var keyWord="";var indentTemp=stream.column(),letter;while((letter=stream.eat(/[^\s\(\[\;\)\]]/))!=null){keyWord+=letter}if(keyWord.length>0&&indentKeys.propertyIsEnumerable(keyWord)){pushStack(state,indentTemp+INDENT_WORD_SKIP,ch)}else{stream.eatSpace();if(stream.eol()||stream.peek()==";"){pushStack(state,indentTemp+1,ch)}else{pushStack(state,indentTemp+stream.current().length,ch)}}stream.backUp(stream.current().length-1);if(typeof state.sExprComment=="number")state.sExprComment++;returnType=BRACKET}else if(ch==")"||ch=="]"){returnType=BRACKET;if(state.indentStack!=null&&state.indentStack.type==(ch==")"?"(":"[")){popStack(state);if(typeof state.sExprComment=="number"){if(--state.sExprComment==0){returnType=COMMENT;state.sExprComment=false}}}}else{stream.eatWhile(/[\w\$_\-!$%&*+\.\/:<=>?@\^~]/);if(keywords&&keywords.propertyIsEnumerable(stream.current())){returnType=BUILTIN}else returnType="variable"}}return typeof state.sExprComment=="number"?COMMENT:returnType},indent:function(state){if(state.indentStack==null)return state.indentation;return state.indentStack.indent},lineComment:";;"}});CodeMirror.defineMIME("text/x-scheme","scheme")}).call(this,require("/Users/timo/Documents/teaching/webchurch/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),typeof self!=="undefined"?self:typeof window!=="undefined"?window:{},require("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/cm-church.js","/")},{"/Users/timo/Documents/teaching/webchurch/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":28,buffer:19,codemirror:30}],"./cm-comments":[function(require,module,exports){module.exports=require("L+quEX")},{}],"L+quEX":[function(require,module,exports){(function(process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){var CodeMirror=require("codemirror");(function(){"use strict";var noOptions={};var nonWS=/[^\s\u00a0]/;var Pos=CodeMirror.Pos;function firstNonWS(str){var found=str.search(nonWS);return found==-1?0:found}CodeMirror.commands.toggleComment=function(cm){var from=cm.getCursor("start"),to=cm.getCursor("end");cm.uncomment(from,to)||cm.lineComment(from,to)};CodeMirror.defineExtension("lineComment",function(from,to,options){if(!options)options=noOptions;var self=this,mode=self.getModeAt(from);var commentString=options.lineComment||mode.lineComment;if(!commentString){if(options.blockCommentStart||mode.blockCommentStart){options.fullLines=true;self.blockComment(from,to,options)}return}var firstLine=self.getLine(from.line);if(firstLine==null)return;var end=Math.min(to.ch!=0||to.line==from.line?to.line+1:to.line,self.lastLine()+1);var pad=options.padding==null?" ":options.padding;var blankLines=options.commentBlankLines||from.line==to.line;self.operation(function(){if(options.indent){var baseString=firstLine.slice(0,firstNonWS(firstLine));for(var i=from.line;i<end;++i){var line=self.getLine(i),cut=baseString.length;if(!blankLines&&!nonWS.test(line))continue;if(line.slice(0,cut)!=baseString)cut=firstNonWS(line);self.replaceRange(baseString+commentString+pad,Pos(i,0),Pos(i,cut))}}else{for(var i=from.line;i<end;++i){if(blankLines||nonWS.test(self.getLine(i)))self.replaceRange(commentString+pad,Pos(i,0))}}})});CodeMirror.defineExtension("blockComment",function(from,to,options){if(!options)options=noOptions;var self=this,mode=self.getModeAt(from);var startString=options.blockCommentStart||mode.blockCommentStart;var endString=options.blockCommentEnd||mode.blockCommentEnd;if(!startString||!endString){if((options.lineComment||mode.lineComment)&&options.fullLines!=false)self.lineComment(from,to,options);return}var end=Math.min(to.line,self.lastLine());if(end!=from.line&&to.ch==0&&nonWS.test(self.getLine(end)))--end;var pad=options.padding==null?" ":options.padding;if(from.line>end)return;self.operation(function(){if(options.fullLines!=false){var lastLineHasText=nonWS.test(self.getLine(end));self.replaceRange(pad+endString,Pos(end));self.replaceRange(startString+pad,Pos(from.line,0));var lead=options.blockCommentLead||mode.blockCommentLead;if(lead!=null)for(var i=from.line+1;i<=end;++i)if(i!=end||lastLineHasText)self.replaceRange(lead+pad,Pos(i,0))}else{self.replaceRange(endString,to);self.replaceRange(startString,from)}})});CodeMirror.defineExtension("uncomment",function(from,to,options){if(!options)options=noOptions;var self=this,mode=self.getModeAt(from);var end=Math.min(to.line,self.lastLine()),start=Math.min(from.line,end);var lineString=options.lineComment||mode.lineComment,lines=[];var pad=options.padding==null?" ":options.padding,didSomething;lineComment:{if(!lineString)break lineComment;for(var i=start;i<=end;++i){var line=self.getLine(i);var found=line.indexOf(lineString);if(found==-1&&(i!=end||i==start)&&nonWS.test(line))break lineComment;if(i!=start&&found>-1&&nonWS.test(line.slice(0,found)))break lineComment;lines.push(line)}self.operation(function(){for(var i=start;i<=end;++i){var line=lines[i-start];var pos=line.indexOf(lineString),endPos=pos+lineString.length;if(pos<0)continue;if(line.slice(endPos,endPos+pad.length)==pad)endPos+=pad.length;didSomething=true;self.replaceRange("",Pos(i,pos),Pos(i,endPos))}});if(didSomething)return true}var startString=options.blockCommentStart||mode.blockCommentStart;var endString=options.blockCommentEnd||mode.blockCommentEnd;if(!startString||!endString)return false;var lead=options.blockCommentLead||mode.blockCommentLead;var startLine=self.getLine(start),endLine=end==start?startLine:self.getLine(end);var open=startLine.indexOf(startString),close=endLine.lastIndexOf(endString);if(close==-1&&start!=end){endLine=self.getLine(--end);close=endLine.lastIndexOf(endString)}if(open==-1||close==-1)return false;self.operation(function(){self.replaceRange("",Pos(end,close-(pad&&endLine.slice(close-pad.length,close)==pad?pad.length:0)),Pos(end,close+endString.length));var openEnd=open+startString.length;if(pad&&startLine.slice(openEnd,openEnd+pad.length)==pad)openEnd+=pad.length;self.replaceRange("",Pos(start,open),Pos(start,openEnd));if(lead)for(var i=start+1;i<=end;++i){var line=self.getLine(i),found=line.indexOf(lead);if(found==-1||nonWS.test(line.slice(0,found)))continue;var foundEnd=found+lead.length;if(pad&&line.slice(foundEnd,foundEnd+pad.length)==pad)foundEnd+=pad.length;self.replaceRange("",Pos(i,found),Pos(i,foundEnd))}});return true})})()}).call(this,require("/Users/timo/Documents/teaching/webchurch/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),typeof self!=="undefined"?self:typeof window!=="undefined"?window:{},require("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/cm-comments.js","/")},{"/Users/timo/Documents/teaching/webchurch/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":28,buffer:19,codemirror:30}],s18hqF:[function(require,module,exports){(function(process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){var CodeMirror=require("codemirror");(function(){"use strict";function doFold(cm,pos,options){var finder=options&&(options.call?options:options.rangeFinder);if(!finder)finder=cm.getHelper(pos,"fold");if(!finder)return;if(typeof pos=="number")pos=CodeMirror.Pos(pos,0);var minSize=options&&options.minFoldSize||0;function getRange(allowFolded){var range=finder(cm,pos);if(!range||range.to.line-range.from.line<minSize)return null;var marks=cm.findMarksAt(range.from);for(var i=0;i<marks.length;++i){if(marks[i].__isFold){if(!allowFolded)return null;range.cleared=true;marks[i].clear()}}return range}var range=getRange(true);if(options&&options.scanUp)while(!range&&pos.line>cm.firstLine()){pos=CodeMirror.Pos(pos.line-1,0);range=getRange(false)}if(!range||range.cleared)return;var myWidget=makeWidget(options);CodeMirror.on(myWidget,"mousedown",function(){myRange.clear()});var myRange=cm.markText(range.from,range.to,{replacedWith:myWidget,clearOnEnter:true,__isFold:true});myRange.on("clear",function(from,to){CodeMirror.signal(cm,"unfold",cm,from,to)});CodeMirror.signal(cm,"fold",cm,range.from,range.to)}function makeWidget(options){var widget=options&&options.widget||"↔";if(typeof widget=="string"){var text=document.createTextNode(widget);widget=document.createElement("span");widget.appendChild(text);widget.className="CodeMirror-foldmarker"}return widget}CodeMirror.newFoldFunction=function(rangeFinder,widget){return function(cm,pos){doFold(cm,pos,{rangeFinder:rangeFinder,widget:widget})}};CodeMirror.defineExtension("foldCode",function(pos,options){doFold(this,pos,options)});CodeMirror.registerHelper("fold","combine",function(){var funcs=Array.prototype.slice.call(arguments,0);return function(cm,start){for(var i=0;i<funcs.length;++i){var found=funcs[i](cm,start);if(found)return found}}})})();var myRangeFinder=function(cm,start){var line=start.line,lineText=cm.getLine(line);if(lineText.indexOf(";;;fold:")!=-1)return tripleCommentRangeFinder(cm,start);var startCh,tokenType;var startToken="(",endToken=")";var startCh=lineText.lastIndexOf("(",start.ch);if(startCh==-1)return;startCh++;tokenType=cm.getTokenTypeAt(CodeMirror.Pos(line,startCh));var count=1,lastLine=cm.lastLine(),end,endCh;outer:for(var i=line;i<=lastLine;++i){var text=cm.getLine(i),pos=i==line?startCh:0;for(;;){var nextOpen=text.indexOf(startToken,pos),nextClose=text.indexOf(endToken,pos);if(nextOpen<0)nextOpen=text.length;if(nextClose<0)nextClose=text.length;pos=Math.min(nextOpen,nextClose);if(pos==text.length)break;if(cm.getTokenTypeAt(CodeMirror.Pos(i,pos+1))==tokenType){if(pos==nextOpen)++count;else if(!--count){end=i;endCh=pos;break outer}}++pos}}if(end==null||line==end&&endCh==startCh)return;return{from:CodeMirror.Pos(line,startCh),to:CodeMirror.Pos(end,endCh)}};var tripleCommentRangeFinder=function(cm,start){var lastLine=cm.lastLine();var pos;for(var i=start.line+1;i<=lastLine;i++){var text=cm.getLine(i);pos=text.indexOf(";;;");if(pos==0){var endCh=cm.getLine(i).length;return{from:CodeMirror.Pos(start.line+1,0),to:CodeMirror.Pos(i,endCh)}}}return};module.exports={tripleCommentRangeFinder:tripleCommentRangeFinder,myRangeFinder:myRangeFinder}}).call(this,require("/Users/timo/Documents/teaching/webchurch/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),typeof self!=="undefined"?self:typeof window!=="undefined"?window:{},require("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/cm-folding.js","/")},{"/Users/timo/Documents/teaching/webchurch/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":28,buffer:19,codemirror:30}],"./cm-folding":[function(require,module,exports){module.exports=require("s18hqF")},{}],fqJoPW:[function(require,module,exports){(function(process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){var evaluate=require("./evaluate").evaluate,format_result=require("./evaluate").format_result;var d3=require("d3");var CodeMirror=require("codemirror");require("./cm-church");require("./cm-brackets");require("./cm-comments");require("./viz");var Backbone=require("backbone");var folding=require("./cm-folding");CodeMirror.keyMap.default["Tab"]="indentAuto";CodeMirror.keyMap.default["Cmd-;"]="toggleComment";CodeMirror.keyMap.default["Cmd-."]=function(cm){cm.foldCode(cm.getCursor(),folding.myRangeFinder)};CodeMirror.keyMap.default["Ctrl-;"]="toggleComment";CodeMirror.keyMap.default["Ctrl-."]=function(cm){cm.foldCode(cm.getCursor(),folding.myRangeFinder)};var _=require("underscore");_.templateSettings={interpolate:/\{\{(.+?)\}\}/g};var runners={};runners["webchurch"]=makewebchurchrunner();runners["webchurch-opt"]=makewebchurchrunner({precompile:true});runners["cosh"]=function(ed){alert("cosh engine down right now :(");ed.trigger("run.finish")};runners["bher"]=function(ed){alert("bher engine down right now :(");ed.trigger("run.finish")};runners["mit-church"]=function(ed){alert("mit-church engine down right now :(");ed.trigger("run.finish")};function wrap(tag,content){return _.template("<{{tag}}>{{content}}</{{tag}}>",{tag:tag,content:content})}function makewebchurchrunner(engineOptions){if(engineOptions===undefined){engineOptions={}}return function(ed){var cm=ed.get("cm");var code=ed.get("code");$results=$("<div class='results'>");if(cm.errormark!=undefined){cm.errormark.clear()}ed.trigger("run.start");try{var runResult=evaluate(code,engineOptions);var underlyingData;sideEffects.forEach(function(e){if(e.type=="string"){$results.append($("<pre>"+e.data+"</pre>"))}if(e.type=="svg"){$results.append($("<div></div>").append(e.data))}if(e.type=="table"){var tableString=wrap("table",e.data.map(function(row){var cols=row.map(function(x){return wrap("td",x)}).join("");return wrap("tr",cols)}).join("\n"));$results.append($(tableString))}if(e.type=="function"){e.data($results)}});underlyingData=runResult;runResult=format_result(runResult);if(!(runResult=="undefined")){$results.append($("<pre>"+runResult+"</pre>"))}}catch(e){ed.set("error",e);var error=e.message;$results.append($("<p></p>").addClass("error").text(error));if(e.stackarray!=undefined){var churchStack=$("<pre></pre>");churchStack.text(e.stackarray.map(function(x){return _.template("{{text}}: {{start}}-{{end}}",x)}).join("\n"));$results.append("<div><u>Church stack array:</u></div>",churchStack);var start=e.start.split(":"),end=e.end.split(":");cm.errormark=cm.markText({line:Number(start[0])-1,ch:Number(start[1])-1},{line:Number(end[0])-1,ch:Number(end[1])},{className:"CodeMirrorError",clearOnEnter:true})}if(typeof e.jsStack!=="undefined"){var jsStack=$("<pre></pre>");jsStack.text(e.jsStack.join("\n"));$results.append("<div><u>JS stack:</u></div>",jsStack)}}finally{ed.display.$results.replaceWith($results);ed.display.$results=$results;ed.trigger("run.finish")}}}var EditorModel=Backbone.Model.extend({initialize:function(options){var ed=this;ed.set("initialOptions",options);var cm=CodeMirror(function(el){},{value:options.code,lineNumbers:false,matchBrackets:true,continueComments:"Enter",viewportMargin:Infinity,autoCloseBrackets:true,mode:"scheme"});ed.set("cm",cm);cm.on("change",function(cmInstance){ed.codeChangedFromUser=true;ed.set({code:cmInstance.getValue()})});ed.on("change:code",function(instance,newCode,options){if(options.programmatic){cm.setValue(newCode)}});var lastLine=cm.lastLine();for(var i=0;i<=lastLine;i++){var txt=cm.getLine(i),pos=txt.indexOf(";;;fold:");if(pos==0){cm.foldCode(CodeMirror.Pos(i,pos),folding.tripleCommentRangeFinder)}}var $results=$("<div class='results'>");$results.hide();var engines=_(runners).keys(),engineSelectorString="<select>\n"+_(engines).map(function(engine){var tmpl=_.template('<option value="{{ engine }}" {{ selectedString }}> {{ engine }} </option>'),str=tmpl({engine:engine,selectedString:engine==ed.get("engine")?"selected":""});return str}).join("\n")+"\n</select>",$engineSelector=$(engineSelectorString);$engineSelector.change(function(e){ed.set("engine",$(this).val())});ed.on("change:engine",function(instance,newEngine,options){if(options.programmatic){ed.display.$engineSelector.val(newEngine)}});var $resetButton=$("<button class='reset'>").html("Reset");$resetButton.click(function(){ed.set(ed.get("initialOptions"),{programmatic:true});ed.trigger("reset");ed.display.$results.hide().html("")});var $runButton=$("<button class='run'>").html("Run");$runButton.click(function(){ed.display.$results.find("*").css("opacity","0.7");$runButton.attr("disabled","disabled");setTimeout(function(){ed.run()},30);ed.on("run.finish",function(){$runButton.removeAttr("disabled")})});var $codeControls=$("<div class='code-controls'>");$codeControls.append($runButton);var $cogMenu=$("<ul class='code-settings'></ul>");$cogMenu.append("<li class='settings-icon'>&#x2630;</li>",$("<li></li>").append($engineSelector[0]),$("<li></li>").append($resetButton[0]));$(cm.display.wrapper).prepend($cogMenu);var wrapper=document.createElement("div");$(cm.display.wrapper).attr("id","ex-"+options.exerciseName);$(cm.display.wrapper).prepend($codeControls);$(wrapper).append(cm.display.wrapper).append($results);ed.display={wrapper:wrapper,$runButton:$runButton,$resetButton:$resetButton,$engineSelector:$engineSelector,$results:$results}},defaults:{code:"",engine:"webchurch"},run:function(){var engine=runners[this.get("engine")];this.set("result",engine(this))},replaceDomEl:function(domEl){$(domEl).replaceWith(this.display.wrapper);this.get("cm").refresh()}});module.exports={EditorModel:EditorModel}}).call(this,require("/Users/timo/Documents/teaching/webchurch/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),typeof self!=="undefined"?self:typeof window!=="undefined"?window:{},require("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/editor.js","/")},{"./cm-brackets":"G8398M","./cm-church":"lO4o+E","./cm-comments":"L+quEX","./cm-folding":"s18hqF","./evaluate":"Ih4X1P","./viz":"mJMf/d","/Users/timo/Documents/teaching/webchurch/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":28,backbone:17,buffer:19,codemirror:30,d3:"Ub4Hh8",underscore:55}],"./editor":[function(require,module,exports){module.exports=require("fqJoPW")},{}],Ih4X1P:[function(require,module,exports){(function(process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){var escodegen=require("escodegen");var esprima=require("esprima");var estraverse=require("escodegen/node_modules/estraverse");var source_map=require("source-map");var tokenize=require("./tokenize.js").tokenize;var church_astify=require("./church_astify.js").church_astify;var church_ast_to_string=require("./church_astify.js").church_ast_to_string;var js_astify=require("./js_astify.js").church_tree_to_esprima_ast;var precompile=require("./precompile.js").precompile;var wctransform=require("./wctransform");var util=require("./util.js");var _=require("underscore");function get_js_to_church_site_map(src_map){var site_map={};var smc=new source_map.SourceMapConsumer(JSON.parse(JSON.stringify(src_map)));smc.eachMapping(function(m){if(m.originalLine){site_map[m.generatedLine]=site_map[m.generatedLine]||{};site_map[m.generatedLine][m.generatedColumn]=m.originalLine+":"+m.originalColumn}});return site_map}function get_church_sites_to_tokens_map(tokens){var map={};for(var i=0;i<tokens.length;i++){map[tokens[i].start]=tokens[i]}return map}function get_sites_from_stack(split_stack){var sites=[];for(var i=0;i<split_stack.length;i++){if(split_stack[i].match("<anonymous>")){var site=split_stack[i].match(/(\d+:\d+)[^:]*$/)[1].split(":");sites.push([site[0],parseInt(site[1]-1)])}else if(sites.length>0){break}}return sites}function churchToBareJs(churchCode){return churchToJs(churchCode,{includePreamble:false,returnCodeOnly:true})}var churchToJs=function(churchCode,options){if(options===undefined){options={}}options=_(options).defaults({compact:false,precompile:false,includePreamble:true,returnCodeOnly:true,wrap:true});var tokens=tokenize(churchCode);var js_ast;if(options.precompile){console.log("pre-compiling...");var js_precompiled=precompile(churchCode);js_ast=esprima.parse(js_precompiled)}else{var church_ast=church_astify(tokens);js_ast=js_astify(church_ast)}js_ast=wctransform.probTransformAST(js_ast,options.includePreamble);var body=js_ast.body;if(body.length>0){var lastStatement=body[body.length-1];if(/Statement/.test(lastStatement.type)){lastStatement.type="ReturnStatement";lastStatement.argument=lastStatement.expression;delete lastStatement.expression}}if(options.wrap){body=[{type:"ExpressionStatement",expression:{type:"CallExpression",callee:{type:"FunctionExpression",id:{type:"Identifier",name:"churchProgram"},params:[],defaults:[],body:{type:"BlockStatement",body:body}},arguments:[]}}]}js_ast.body=body;var code_and_source_map=escodegen.generate(js_ast,{sourceMap:"whatever",sourceMapWithCode:true,format:{compact:options.compact}});if(options.returnCodeOnly){return code_and_source_map.code}else{return{tokens:tokens,code_and_source_map:code_and_source_map}}};function evaluate(church_codestring,options){function really_evaluate(){var result=eval(jsCode);var t2=(new Date).getTime();if(options.timed)console.log("Time to execute: "+(t2-t1)+"ms");return result}var t0=(new Date).getTime();options=options||{};options.returnCodeOnly=false;if(options.desugar)return church_ast_to_string(church_astify(tokenize(church_codestring)));var compileResult=churchToJs(church_codestring,options);var tokens=compileResult.tokens;var code_and_source_map=compileResult.code_and_source_map;var jsCode=code_and_source_map.code;var sourceMap=code_and_source_map.map;sideEffects=[];if(gensym){gensym.__gensymcounter__=0}if(options.compile)return jsCode;var result;var t1=(new Date).getTime();if(options.timed)console.log("Time to compile: "+(t1-t0)+"ms");var argstring=options.argstring;if(options.disable_church_errors)return really_evaluate();try{result=really_evaluate()}catch(err){var js_to_church_site_map=get_js_to_church_site_map(sourceMap);var churchLines=church_codestring.split("\n");var church_sites_to_tokens_map=get_church_sites_to_tokens_map(tokens);var stack=err.stack?err.stack.split("\n"):[":"];var msg=stack[0].split(":");console.log(err.stack);var js_sites=get_sites_from_stack(stack.slice(1));var church_sites=[];for(var i=0;i<js_sites.length;i++){var js_site=js_sites[i];var church_site=js_to_church_site_map[js_site[0]]&&js_to_church_site_map[js_site[0]][js_site[1]];if(church_site){church_sites.push(church_site)}}if(church_sites.length==0){throw err}else{var token=church_sites_to_tokens_map[church_sites[0]];var fntoken;if(token.text=="("){var tokStart=token.start,tokEnd=token.end,tokeNum;for(var j=0,jj=tokens.length;j<jj;j++){if(tokens[j].start==tokStart&&tokens[j].end==tokEnd){tokeNum=j}}fntoken=tokens[tokeNum+1]}var displayedMessage;if(msg[0]=="ReferenceError"){token=fntoken?fntoken:token;displayedMessage=token.text+" is not defined"}else if(msg[0]=="TypeError"){token=fntoken?fntoken:token;displayedMessage=token.text+" is not a function"}else{displayedMessage=err.message.replace("<<functionName>>",fntoken?fntoken.text:token.text)}var e=util.make_church_error(msg[0],token.start,token.end,displayedMessage);e.stack=church_sites.map(function(x){var tok=church_sites_to_tokens_map[x];return tok.start+"-"+tok.end}).join(",");e.stackarray=church_sites.map(function(x){return church_sites_to_tokens_map[x]});e.jsStack=stack;throw e}}return result}module.exports={evaluate:evaluate,format_result:util.format_result,churchToJs:churchToJs,churchToBareJs:churchToBareJs}}).call(this,require("/Users/timo/Documents/teaching/webchurch/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),typeof self!=="undefined"?self:typeof window!=="undefined"?window:{},require("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/evaluate.js","/");
assets/js/webchurch.min.js:var match=matching[ch];if(match.charAt(1)==">"==dir>0)stack.push(ch);else if(!stack.length)return{pos:Pos(lineNo,pos),ch:ch};else stack.pop()}}}return lineNo-dir==(dir>0?cm.lastLine():cm.firstLine())?false:null}function matchBrackets(cm,autoclear,config){var maxHighlightLen=cm.state.matchBrackets.maxHighlightLineLength||1e3;var marks=[],ranges=cm.listSelections();for(var i=0;i<ranges.length;i++){var match=ranges[i].empty()&&findMatchingBracket(cm,ranges[i].head,false,config);if(match&&cm.getLine(match.from.line).length<=maxHighlightLen){var style=match.match?"CodeMirror-matchingbracket":"CodeMirror-nonmatchingbracket";marks.push(cm.markText(match.from,Pos(match.from.line,match.from.ch+1),{className:style}));if(match.to&&cm.getLine(match.to.line).length<=maxHighlightLen)marks.push(cm.markText(match.to,Pos(match.to.line,match.to.ch+1),{className:style}))}}if(marks.length){if(ie_lt8&&cm.state.focused)cm.display.input.focus();var clear=function(){cm.operation(function(){for(var i=0;i<marks.length;i++)marks[i].clear()})};if(autoclear)setTimeout(clear,800);else return clear}}var currentlyHighlighted=null;function doMatchBrackets(cm){cm.operation(function(){if(currentlyHighlighted){currentlyHighlighted();currentlyHighlighted=null}currentlyHighlighted=matchBrackets(cm,false,cm.state.matchBrackets)})}CodeMirror.defineOption("matchBrackets",false,function(cm,val,old){if(old&&old!=CodeMirror.Init)cm.off("cursorActivity",doMatchBrackets);if(val){cm.state.matchBrackets=typeof val=="object"?val:{};cm.on("cursorActivity",doMatchBrackets)}});CodeMirror.defineExtension("matchBrackets",function(){matchBrackets(this,true)});CodeMirror.defineExtension("findMatchingBracket",function(pos,strict,config){return findMatchingBracket(this,pos,strict,config)});CodeMirror.defineExtension("scanForBracket",function(pos,dir,style,config){return scanForBracket(this,pos,dir,style,config)})})()}).call(this,require("/Users/timo/Documents/teaching/webchurch/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),typeof self!=="undefined"?self:typeof window!=="undefined"?window:{},require("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/cm-brackets.js","/")},{"/Users/timo/Documents/teaching/webchurch/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":28,buffer:19,codemirror:30}],"./cm-church":[function(require,module,exports){module.exports=require("lO4o+E")},{}],"lO4o+E":[function(require,module,exports){(function(process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){var CodeMirror=require("codemirror");CodeMirror.defineMode("scheme",function(){var BUILTIN="builtin",COMMENT="comment",STRING="string",ATOM="atom",NUMBER="number",BRACKET="bracket";var INDENT_WORD_SKIP=2;function makeKeywords(str){var obj={},words=str.split(" ");for(var i=0;i<words.length;++i)obj[words[i]]=true;return obj}var keywords=makeKeywords("λ case-lambda call/cc class define-class exit-handler field import inherit init-field interface let*-values let-values let/ec mixin opt-lambda override protect provide public rename require require-for-syntax syntax syntax-case syntax-error unit/sig unless when with-syntax and begin call-with-current-continuation call-with-input-file call-with-output-file case cond define define-syntax delay do dynamic-wind else for-each if lambda let let* let-syntax letrec letrec-syntax map or syntax-rules abs acos angle append apply asin assoc assq assv atan boolean? caar cadr call-with-values car cdddar cddddr cdr ceiling char->integer char-alphabetic? char-ci<=? char-ci<? char-ci=? char-ci>=? char-ci>? char-downcase char-lower-case? char-numeric? char-ready? char-upcase char-upper-case? char-whitespace? char<=? char<? char=? char>=? char>? char? close-input-port close-output-port complex? cons cos current-input-port current-output-port denominator display eof-object? eq? equal? eqv? eval even? exact->inexact exact? exp expt #f floor force gcd imag-part inexact->exact inexact? input-port? integer->char integer? interaction-environment lcm length list list->string list->vector list-ref list-tail list? load log magnitude make-polar make-rectangular make-string make-vector max member memq memv min modulo negative? newline not null-environment null? number->string number? numerator odd? open-input-file open-output-file output-port? pair? peek-char port? positive? procedure? quasiquote quote quotient rational? rationalize read read-char real-part real? remainder reverse round scheme-report-environment set! set-car! set-cdr! sin sqrt string string->list string->number string->symbol string-append string-ci<=? string-ci<? string-ci=? string-ci>=? string-ci>? string-copy string-fill! string-length string-ref string-set! string<=? string<? string=? string>=? string>? string? substring symbol->string symbol? #t tan transcript-off transcript-on truncate values vector vector->list vector-fill! vector-length vector-ref vector-set! with-input-from-file with-output-to-file write write-char zero? barplot enumeration-query rejection-query mh-query condition factor fold flatten pair first second third fourth fifth sixth seventh rest flip hist repeat gaussian density multiviz uniform-draw mem sum runPhysics animatePhysics uniform worldWidth worldHeight scatter lineplot dirichlet multinomial beta mean");var indentKeys=makeKeywords("define let letrec let* lambda");function stateStack(indent,type,prev){this.indent=indent;this.type=type;this.prev=prev}function pushStack(state,indent,type){state.indentStack=new stateStack(indent,type,state.indentStack)}function popStack(state){state.indentStack=state.indentStack.prev}var binaryMatcher=new RegExp(/^(?:[-+]i|[-+][01]+#*(?:\/[01]+#*)?i|[-+]?[01]+#*(?:\/[01]+#*)?@[-+]?[01]+#*(?:\/[01]+#*)?|[-+]?[01]+#*(?:\/[01]+#*)?[-+](?:[01]+#*(?:\/[01]+#*)?)?i|[-+]?[01]+#*(?:\/[01]+#*)?)(?=[()\s;"]|$)/i);var octalMatcher=new RegExp(/^(?:[-+]i|[-+][0-7]+#*(?:\/[0-7]+#*)?i|[-+]?[0-7]+#*(?:\/[0-7]+#*)?@[-+]?[0-7]+#*(?:\/[0-7]+#*)?|[-+]?[0-7]+#*(?:\/[0-7]+#*)?[-+](?:[0-7]+#*(?:\/[0-7]+#*)?)?i|[-+]?[0-7]+#*(?:\/[0-7]+#*)?)(?=[()\s;"]|$)/i);var hexMatcher=new RegExp(/^(?:[-+]i|[-+][\da-f]+#*(?:\/[\da-f]+#*)?i|[-+]?[\da-f]+#*(?:\/[\da-f]+#*)?@[-+]?[\da-f]+#*(?:\/[\da-f]+#*)?|[-+]?[\da-f]+#*(?:\/[\da-f]+#*)?[-+](?:[\da-f]+#*(?:\/[\da-f]+#*)?)?i|[-+]?[\da-f]+#*(?:\/[\da-f]+#*)?)(?=[()\s;"]|$)/i);var decimalMatcher=new RegExp(/^(?:[-+]i|[-+](?:(?:(?:\d+#+\.?#*|\d+\.\d*#*|\.\d+#*|\d+)(?:[esfdl][-+]?\d+)?)|\d+#*\/\d+#*)i|[-+]?(?:(?:(?:\d+#+\.?#*|\d+\.\d*#*|\.\d+#*|\d+)(?:[esfdl][-+]?\d+)?)|\d+#*\/\d+#*)@[-+]?(?:(?:(?:\d+#+\.?#*|\d+\.\d*#*|\.\d+#*|\d+)(?:[esfdl][-+]?\d+)?)|\d+#*\/\d+#*)|[-+]?(?:(?:(?:\d+#+\.?#*|\d+\.\d*#*|\.\d+#*|\d+)(?:[esfdl][-+]?\d+)?)|\d+#*\/\d+#*)[-+](?:(?:(?:\d+#+\.?#*|\d+\.\d*#*|\.\d+#*|\d+)(?:[esfdl][-+]?\d+)?)|\d+#*\/\d+#*)?i|(?:(?:(?:\d+#+\.?#*|\d+\.\d*#*|\.\d+#*|\d+)(?:[esfdl][-+]?\d+)?)|\d+#*\/\d+#*))(?=[()\s;"]|$)/i);function isBinaryNumber(stream){return stream.match(binaryMatcher)}function isOctalNumber(stream){return stream.match(octalMatcher)}function isDecimalNumber(stream,backup){if(backup===true){stream.backUp(1)}return stream.match(decimalMatcher)}function isHexNumber(stream){return stream.match(hexMatcher)}return{startState:function(){return{indentStack:null,indentation:0,mode:false,sExprComment:false}},token:function(stream,state){if(state.indentStack==null&&stream.sol()){state.indentation=stream.indentation()}if(stream.eatSpace()){return null}var returnType=null;switch(state.mode){case"string":var next,escaped=false;while((next=stream.next())!=null){if(next=='"'&&!escaped){state.mode=false;break}escaped=!escaped&&next=="\\"}returnType=STRING;break;case"comment":var next,maybeEnd=false;while((next=stream.next())!=null){if(next=="#"&&maybeEnd){state.mode=false;break}maybeEnd=next=="|"}returnType=COMMENT;break;case"s-expr-comment":state.mode=false;if(stream.peek()=="("||stream.peek()=="["){state.sExprComment=0}else{stream.eatWhile(/[^\/s]/);returnType=COMMENT;break}default:var ch=stream.next();if(ch=='"'){state.mode="string";returnType=STRING}else if(ch=="'"){returnType=ATOM}else if(ch=="#"){if(stream.eat("|")){state.mode="comment";returnType=COMMENT}else if(stream.eat(/[tf]/i)){returnType=ATOM}else if(stream.eat(";")){state.mode="s-expr-comment";returnType=COMMENT}else{var numTest=null,hasExactness=false,hasRadix=true;if(stream.eat(/[ei]/i)){hasExactness=true}else{stream.backUp(1)}if(stream.match(/^#b/i)){numTest=isBinaryNumber}else if(stream.match(/^#o/i)){numTest=isOctalNumber}else if(stream.match(/^#x/i)){numTest=isHexNumber}else if(stream.match(/^#d/i)){numTest=isDecimalNumber}else if(stream.match(/^[-+0-9.]/,false)){hasRadix=false;numTest=isDecimalNumber}else if(!hasExactness){stream.eat("#")}if(numTest!=null){if(hasRadix&&!hasExactness){stream.match(/^#[ei]/i)}if(numTest(stream))returnType=NUMBER}}}else if(/^[-+0-9.]/.test(ch)&&isDecimalNumber(stream,true)){returnType=NUMBER}else if(ch==";"){stream.skipToEnd();returnType=COMMENT}else if(ch=="("||ch=="["){var keyWord="";var indentTemp=stream.column(),letter;while((letter=stream.eat(/[^\s\(\[\;\)\]]/))!=null){keyWord+=letter}if(keyWord.length>0&&indentKeys.propertyIsEnumerable(keyWord)){pushStack(state,indentTemp+INDENT_WORD_SKIP,ch)}else{stream.eatSpace();if(stream.eol()||stream.peek()==";"){pushStack(state,indentTemp+1,ch)}else{pushStack(state,indentTemp+stream.current().length,ch)}}stream.backUp(stream.current().length-1);if(typeof state.sExprComment=="number")state.sExprComment++;returnType=BRACKET}else if(ch==")"||ch=="]"){returnType=BRACKET;if(state.indentStack!=null&&state.indentStack.type==(ch==")"?"(":"[")){popStack(state);if(typeof state.sExprComment=="number"){if(--state.sExprComment==0){returnType=COMMENT;state.sExprComment=false}}}}else{stream.eatWhile(/[\w\$_\-!$%&*+\.\/:<=>?@\^~]/);if(keywords&&keywords.propertyIsEnumerable(stream.current())){returnType=BUILTIN}else returnType="variable"}}return typeof state.sExprComment=="number"?COMMENT:returnType},indent:function(state){if(state.indentStack==null)return state.indentation;return state.indentStack.indent},lineComment:";;"}});CodeMirror.defineMIME("text/x-scheme","scheme")}).call(this,require("/Users/timo/Documents/teaching/webchurch/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),typeof self!=="undefined"?self:typeof window!=="undefined"?window:{},require("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/cm-church.js","/")},{"/Users/timo/Documents/teaching/webchurch/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":28,buffer:19,codemirror:30}],"./cm-comments":[function(require,module,exports){module.exports=require("L+quEX")},{}],"L+quEX":[function(require,module,exports){(function(process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){var CodeMirror=require("codemirror");(function(){"use strict";var noOptions={};var nonWS=/[^\s\u00a0]/;var Pos=CodeMirror.Pos;function firstNonWS(str){var found=str.search(nonWS);return found==-1?0:found}CodeMirror.commands.toggleComment=function(cm){var from=cm.getCursor("start"),to=cm.getCursor("end");cm.uncomment(from,to)||cm.lineComment(from,to)};CodeMirror.defineExtension("lineComment",function(from,to,options){if(!options)options=noOptions;var self=this,mode=self.getModeAt(from);var commentString=options.lineComment||mode.lineComment;if(!commentString){if(options.blockCommentStart||mode.blockCommentStart){options.fullLines=true;self.blockComment(from,to,options)}return}var firstLine=self.getLine(from.line);if(firstLine==null)return;var end=Math.min(to.ch!=0||to.line==from.line?to.line+1:to.line,self.lastLine()+1);var pad=options.padding==null?" ":options.padding;var blankLines=options.commentBlankLines||from.line==to.line;self.operation(function(){if(options.indent){var baseString=firstLine.slice(0,firstNonWS(firstLine));for(var i=from.line;i<end;++i){var line=self.getLine(i),cut=baseString.length;if(!blankLines&&!nonWS.test(line))continue;if(line.slice(0,cut)!=baseString)cut=firstNonWS(line);self.replaceRange(baseString+commentString+pad,Pos(i,0),Pos(i,cut))}}else{for(var i=from.line;i<end;++i){if(blankLines||nonWS.test(self.getLine(i)))self.replaceRange(commentString+pad,Pos(i,0))}}})});CodeMirror.defineExtension("blockComment",function(from,to,options){if(!options)options=noOptions;var self=this,mode=self.getModeAt(from);var startString=options.blockCommentStart||mode.blockCommentStart;var endString=options.blockCommentEnd||mode.blockCommentEnd;if(!startString||!endString){if((options.lineComment||mode.lineComment)&&options.fullLines!=false)self.lineComment(from,to,options);return}var end=Math.min(to.line,self.lastLine());if(end!=from.line&&to.ch==0&&nonWS.test(self.getLine(end)))--end;var pad=options.padding==null?" ":options.padding;if(from.line>end)return;self.operation(function(){if(options.fullLines!=false){var lastLineHasText=nonWS.test(self.getLine(end));self.replaceRange(pad+endString,Pos(end));self.replaceRange(startString+pad,Pos(from.line,0));var lead=options.blockCommentLead||mode.blockCommentLead;if(lead!=null)for(var i=from.line+1;i<=end;++i)if(i!=end||lastLineHasText)self.replaceRange(lead+pad,Pos(i,0))}else{self.replaceRange(endString,to);self.replaceRange(startString,from)}})});CodeMirror.defineExtension("uncomment",function(from,to,options){if(!options)options=noOptions;var self=this,mode=self.getModeAt(from);var end=Math.min(to.line,self.lastLine()),start=Math.min(from.line,end);var lineString=options.lineComment||mode.lineComment,lines=[];var pad=options.padding==null?" ":options.padding,didSomething;lineComment:{if(!lineString)break lineComment;for(var i=start;i<=end;++i){var line=self.getLine(i);var found=line.indexOf(lineString);if(found==-1&&(i!=end||i==start)&&nonWS.test(line))break lineComment;if(i!=start&&found>-1&&nonWS.test(line.slice(0,found)))break lineComment;lines.push(line)}self.operation(function(){for(var i=start;i<=end;++i){var line=lines[i-start];var pos=line.indexOf(lineString),endPos=pos+lineString.length;if(pos<0)continue;if(line.slice(endPos,endPos+pad.length)==pad)endPos+=pad.length;didSomething=true;self.replaceRange("",Pos(i,pos),Pos(i,endPos))}});if(didSomething)return true}var startString=options.blockCommentStart||mode.blockCommentStart;var endString=options.blockCommentEnd||mode.blockCommentEnd;if(!startString||!endString)return false;var lead=options.blockCommentLead||mode.blockCommentLead;var startLine=self.getLine(start),endLine=end==start?startLine:self.getLine(end);var open=startLine.indexOf(startString),close=endLine.lastIndexOf(endString);if(close==-1&&start!=end){endLine=self.getLine(--end);close=endLine.lastIndexOf(endString)}if(open==-1||close==-1)return false;self.operation(function(){self.replaceRange("",Pos(end,close-(pad&&endLine.slice(close-pad.length,close)==pad?pad.length:0)),Pos(end,close+endString.length));var openEnd=open+startString.length;if(pad&&startLine.slice(openEnd,openEnd+pad.length)==pad)openEnd+=pad.length;self.replaceRange("",Pos(start,open),Pos(start,openEnd));if(lead)for(var i=start+1;i<=end;++i){var line=self.getLine(i),found=line.indexOf(lead);if(found==-1||nonWS.test(line.slice(0,found)))continue;var foundEnd=found+lead.length;if(pad&&line.slice(foundEnd,foundEnd+pad.length)==pad)foundEnd+=pad.length;self.replaceRange("",Pos(i,found),Pos(i,foundEnd))}});return true})})()}).call(this,require("/Users/timo/Documents/teaching/webchurch/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),typeof self!=="undefined"?self:typeof window!=="undefined"?window:{},require("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/cm-comments.js","/")},{"/Users/timo/Documents/teaching/webchurch/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":28,buffer:19,codemirror:30}],s18hqF:[function(require,module,exports){(function(process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){var CodeMirror=require("codemirror");(function(){"use strict";function doFold(cm,pos,options){var finder=options&&(options.call?options:options.rangeFinder);if(!finder)finder=cm.getHelper(pos,"fold");if(!finder)return;if(typeof pos=="number")pos=CodeMirror.Pos(pos,0);var minSize=options&&options.minFoldSize||0;function getRange(allowFolded){var range=finder(cm,pos);if(!range||range.to.line-range.from.line<minSize)return null;var marks=cm.findMarksAt(range.from);for(var i=0;i<marks.length;++i){if(marks[i].__isFold){if(!allowFolded)return null;range.cleared=true;marks[i].clear()}}return range}var range=getRange(true);if(options&&options.scanUp)while(!range&&pos.line>cm.firstLine()){pos=CodeMirror.Pos(pos.line-1,0);range=getRange(false)}if(!range||range.cleared)return;var myWidget=makeWidget(options);CodeMirror.on(myWidget,"mousedown",function(){myRange.clear()});var myRange=cm.markText(range.from,range.to,{replacedWith:myWidget,clearOnEnter:true,__isFold:true});myRange.on("clear",function(from,to){CodeMirror.signal(cm,"unfold",cm,from,to)});CodeMirror.signal(cm,"fold",cm,range.from,range.to)}function makeWidget(options){var widget=options&&options.widget||"↔";if(typeof widget=="string"){var text=document.createTextNode(widget);widget=document.createElement("span");widget.appendChild(text);widget.className="CodeMirror-foldmarker"}return widget}CodeMirror.newFoldFunction=function(rangeFinder,widget){return function(cm,pos){doFold(cm,pos,{rangeFinder:rangeFinder,widget:widget})}};CodeMirror.defineExtension("foldCode",function(pos,options){doFold(this,pos,options)});CodeMirror.registerHelper("fold","combine",function(){var funcs=Array.prototype.slice.call(arguments,0);return function(cm,start){for(var i=0;i<funcs.length;++i){var found=funcs[i](cm,start);if(found)return found}}})})();var myRangeFinder=function(cm,start){var line=start.line,lineText=cm.getLine(line);if(lineText.indexOf(";;;fold:")!=-1)return tripleCommentRangeFinder(cm,start);var startCh,tokenType;var startToken="(",endToken=")";var startCh=lineText.lastIndexOf("(",start.ch);if(startCh==-1)return;startCh++;tokenType=cm.getTokenTypeAt(CodeMirror.Pos(line,startCh));var count=1,lastLine=cm.lastLine(),end,endCh;outer:for(var i=line;i<=lastLine;++i){var text=cm.getLine(i),pos=i==line?startCh:0;for(;;){var nextOpen=text.indexOf(startToken,pos),nextClose=text.indexOf(endToken,pos);if(nextOpen<0)nextOpen=text.length;if(nextClose<0)nextClose=text.length;pos=Math.min(nextOpen,nextClose);if(pos==text.length)break;if(cm.getTokenTypeAt(CodeMirror.Pos(i,pos+1))==tokenType){if(pos==nextOpen)++count;else if(!--count){end=i;endCh=pos;break outer}}++pos}}if(end==null||line==end&&endCh==startCh)return;return{from:CodeMirror.Pos(line,startCh),to:CodeMirror.Pos(end,endCh)}};var tripleCommentRangeFinder=function(cm,start){var lastLine=cm.lastLine();var pos;for(var i=start.line+1;i<=lastLine;i++){var text=cm.getLine(i);pos=text.indexOf(";;;");if(pos==0){var endCh=cm.getLine(i).length;return{from:CodeMirror.Pos(start.line+1,0),to:CodeMirror.Pos(i,endCh)}}}return};module.exports={tripleCommentRangeFinder:tripleCommentRangeFinder,myRangeFinder:myRangeFinder}}).call(this,require("/Users/timo/Documents/teaching/webchurch/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),typeof self!=="undefined"?self:typeof window!=="undefined"?window:{},require("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/cm-folding.js","/")},{"/Users/timo/Documents/teaching/webchurch/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":28,buffer:19,codemirror:30}],"./cm-folding":[function(require,module,exports){module.exports=require("s18hqF")},{}],fqJoPW:[function(require,module,exports){(function(process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){var evaluate=require("./evaluate").evaluate,format_result=require("./evaluate").format_result;var d3=require("d3");var CodeMirror=require("codemirror");require("./cm-church");require("./cm-brackets");require("./cm-comments");require("./viz");var Backbone=require("backbone");var folding=require("./cm-folding");CodeMirror.keyMap.default["Tab"]="indentAuto";CodeMirror.keyMap.default["Cmd-;"]="toggleComment";CodeMirror.keyMap.default["Cmd-."]=function(cm){cm.foldCode(cm.getCursor(),folding.myRangeFinder)};CodeMirror.keyMap.default["Ctrl-;"]="toggleComment";CodeMirror.keyMap.default["Ctrl-."]=function(cm){cm.foldCode(cm.getCursor(),folding.myRangeFinder)};var _=require("underscore");_.templateSettings={interpolate:/\{\{(.+?)\}\}/g};var runners={};runners["webchurch"]=makewebchurchrunner();runners["webchurch-opt"]=makewebchurchrunner({precompile:true});runners["cosh"]=function(ed){alert("cosh engine down right now :(");ed.trigger("run.finish")};runners["bher"]=function(ed){alert("bher engine down right now :(");ed.trigger("run.finish")};runners["mit-church"]=function(ed){alert("mit-church engine down right now :(");ed.trigger("run.finish")};function wrap(tag,content){return _.template("<{{tag}}>{{content}}</{{tag}}>",{tag:tag,content:content})}function makewebchurchrunner(engineOptions){if(engineOptions===undefined){engineOptions={}}return function(ed){var cm=ed.get("cm");var code=ed.get("code");$results=$("<div class='results'>");if(cm.errormark!=undefined){cm.errormark.clear()}ed.trigger("run.start");try{var runResult=evaluate(code,engineOptions);var underlyingData;sideEffects.forEach(function(e){if(e.type=="string"){$results.append($("<pre>"+e.data+"</pre>"))}if(e.type=="svg"){$results.append($("<div></div>").append(e.data))}if(e.type=="table"){var tableString=wrap("table",e.data.map(function(row){var cols=row.map(function(x){return wrap("td",x)}).join("");return wrap("tr",cols)}).join("\n"));$results.append($(tableString))}if(e.type=="function"){e.data($results)}});underlyingData=runResult;runResult=format_result(runResult);if(!(runResult=="undefined")){$results.append($("<pre>"+runResult+"</pre>"))}}catch(e){ed.set("error",e);var error=e.message;$results.append($("<p></p>").addClass("error").text(error));if(e.stackarray!=undefined){var churchStack=$("<pre></pre>");churchStack.text(e.stackarray.map(function(x){return _.template("{{text}}: {{start}}-{{end}}",x)}).join("\n"));$results.append("<div><u>Church stack array:</u></div>",churchStack);var start=e.start.split(":"),end=e.end.split(":");cm.errormark=cm.markText({line:Number(start[0])-1,ch:Number(start[1])-1},{line:Number(end[0])-1,ch:Number(end[1])},{className:"CodeMirrorError",clearOnEnter:true})}if(typeof e.jsStack!=="undefined"){var jsStack=$("<pre></pre>");jsStack.text(e.jsStack.join("\n"));$results.append("<div><u>JS stack:</u></div>",jsStack)}}finally{ed.display.$results.replaceWith($results);ed.display.$results=$results;ed.trigger("run.finish")}}}var EditorModel=Backbone.Model.extend({initialize:function(options){var ed=this;ed.set("initialOptions",options);var cm=CodeMirror(function(el){},{value:options.code,lineNumbers:false,matchBrackets:true,continueComments:"Enter",viewportMargin:Infinity,autoCloseBrackets:true,mode:"scheme"});ed.set("cm",cm);cm.on("change",function(cmInstance){ed.codeChangedFromUser=true;ed.set({code:cmInstance.getValue()})});ed.on("change:code",function(instance,newCode,options){if(options.programmatic){cm.setValue(newCode)}});var lastLine=cm.lastLine();for(var i=0;i<=lastLine;i++){var txt=cm.getLine(i),pos=txt.indexOf(";;;fold:");if(pos==0){cm.foldCode(CodeMirror.Pos(i,pos),folding.tripleCommentRangeFinder)}}var $results=$("<div class='results'>");$results.hide();var engines=_(runners).keys(),engineSelectorString="<select>\n"+_(engines).map(function(engine){var tmpl=_.template('<option value="{{ engine }}" {{ selectedString }}> {{ engine }} </option>'),str=tmpl({engine:engine,selectedString:engine==ed.get("engine")?"selected":""});return str}).join("\n")+"\n</select>",$engineSelector=$(engineSelectorString);$engineSelector.change(function(e){ed.set("engine",$(this).val())});ed.on("change:engine",function(instance,newEngine,options){if(options.programmatic){ed.display.$engineSelector.val(newEngine)}});var $resetButton=$("<button class='reset'>").html("Reset");$resetButton.click(function(){ed.set(ed.get("initialOptions"),{programmatic:true});ed.trigger("reset");ed.display.$results.hide().html("")});var $runButton=$("<button class='run'>").html("Run");$runButton.click(function(){ed.display.$results.find("*").css("opacity","0.7");$runButton.attr("disabled","disabled");setTimeout(function(){ed.run()},30);ed.on("run.finish",function(){$runButton.removeAttr("disabled")})});var $codeControls=$("<div class='code-controls'>");$codeControls.append($runButton);var $cogMenu=$("<ul class='code-settings'></ul>");$cogMenu.append("<li class='settings-icon'>&#x2630;</li>",$("<li></li>").append($engineSelector[0]),$("<li></li>").append($resetButton[0]));$(cm.display.wrapper).prepend($cogMenu);var wrapper=document.createElement("div");$(cm.display.wrapper).attr("id","ex-"+options.exerciseName);$(cm.display.wrapper).prepend($codeControls);$(wrapper).append(cm.display.wrapper).append($results);ed.display={wrapper:wrapper,$runButton:$runButton,$resetButton:$resetButton,$engineSelector:$engineSelector,$results:$results}},defaults:{code:"",engine:"webchurch"},run:function(){var engine=runners[this.get("engine")];this.set("result",engine(this))},replaceDomEl:function(domEl){$(domEl).replaceWith(this.display.wrapper);this.get("cm").refresh()}});module.exports={EditorModel:EditorModel}}).call(this,require("/Users/timo/Documents/teaching/webchurch/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),typeof self!=="undefined"?self:typeof window!=="undefined"?window:{},require("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/editor.js","/")},{"./cm-brackets":"G8398M","./cm-church":"lO4o+E","./cm-comments":"L+quEX","./cm-folding":"s18hqF","./evaluate":"Ih4X1P","./viz":"mJMf/d","/Users/timo/Documents/teaching/webchurch/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":28,backbone:17,buffer:19,codemirror:30,d3:"Ub4Hh8",underscore:55}],"./editor":[function(require,module,exports){module.exports=require("fqJoPW")},{}],Ih4X1P:[function(require,module,exports){(function(process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){var escodegen=require("escodegen");var esprima=require("esprima");var estraverse=require("escodegen/node_modules/estraverse");var source_map=require("source-map");var tokenize=require("./tokenize.js").tokenize;var church_astify=require("./church_astify.js").church_astify;var church_ast_to_string=require("./church_astify.js").church_ast_to_string;var js_astify=require("./js_astify.js").church_tree_to_esprima_ast;var precompile=require("./precompile.js").precompile;var wctransform=require("./wctransform");var util=require("./util.js");var _=require("underscore");function get_js_to_church_site_map(src_map){var site_map={};var smc=new source_map.SourceMapConsumer(JSON.parse(JSON.stringify(src_map)));smc.eachMapping(function(m){if(m.originalLine){site_map[m.generatedLine]=site_map[m.generatedLine]||{};site_map[m.generatedLine][m.generatedColumn]=m.originalLine+":"+m.originalColumn}});return site_map}function get_church_sites_to_tokens_map(tokens){var map={};for(var i=0;i<tokens.length;i++){map[tokens[i].start]=tokens[i]}return map}function get_sites_from_stack(split_stack){var sites=[];for(var i=0;i<split_stack.length;i++){if(split_stack[i].match("<anonymous>")){var site=split_stack[i].match(/(\d+:\d+)[^:]*$/)[1].split(":");sites.push([site[0],parseInt(site[1]-1)])}else if(sites.length>0){break}}return sites}function churchToBareJs(churchCode){return churchToJs(churchCode,{includePreamble:false,returnCodeOnly:true})}var churchToJs=function(churchCode,options){if(options===undefined){options={}}options=_(options).defaults({compact:false,precompile:false,includePreamble:true,returnCodeOnly:true,wrap:true});var tokens=tokenize(churchCode);var js_ast;if(options.precompile){console.log("pre-compiling...");var js_precompiled=precompile(churchCode);js_ast=esprima.parse(js_precompiled)}else{var church_ast=church_astify(tokens);js_ast=js_astify(church_ast)}js_ast=wctransform.probTransformAST(js_ast,options.includePreamble);var body=js_ast.body;if(body.length>0){var lastStatement=body[body.length-1];if(/Statement/.test(lastStatement.type)){lastStatement.type="ReturnStatement";lastStatement.argument=lastStatement.expression;delete lastStatement.expression}}if(options.wrap){body=[{type:"ExpressionStatement",expression:{type:"CallExpression",callee:{type:"FunctionExpression",id:{type:"Identifier",name:"churchProgram"},params:[],defaults:[],body:{type:"BlockStatement",body:body}},arguments:[]}}]}js_ast.body=body;var code_and_source_map=escodegen.generate(js_ast,{sourceMap:"whatever",sourceMapWithCode:true,format:{compact:options.compact}});if(options.returnCodeOnly){return code_and_source_map.code}else{return{tokens:tokens,code_and_source_map:code_and_source_map}}};function evaluate(church_codestring,options){function really_evaluate(){var result=eval(jsCode);var t2=(new Date).getTime();if(options.timed)console.log("Time to execute: "+(t2-t1)+"ms");return result}var t0=(new Date).getTime();options=options||{};options.returnCodeOnly=false;if(options.desugar)return church_ast_to_string(church_astify(tokenize(church_codestring)));var compileResult=churchToJs(church_codestring,options);var tokens=compileResult.tokens;var code_and_source_map=compileResult.code_and_source_map;var jsCode=code_and_source_map.code;var sourceMap=code_and_source_map.map;sideEffects=[];if(gensym){gensym.__gensymcounter__=0}if(options.compile)return jsCode;var result;var t1=(new Date).getTime();if(options.timed)console.log("Time to compile: "+(t1-t0)+"ms");var argstring=options.argstring;if(options.disable_church_errors)return really_evaluate();try{result=really_evaluate()}catch(err){var js_to_church_site_map=get_js_to_church_site_map(sourceMap);var churchLines=church_codestring.split("\n");var church_sites_to_tokens_map=get_church_sites_to_tokens_map(tokens);var stack=err.stack?err.stack.split("\n"):[":"];var msg=stack[0].split(":");console.log(err.stack);var js_sites=get_sites_from_stack(stack.slice(1));var church_sites=[];for(var i=0;i<js_sites.length;i++){var js_site=js_sites[i];var church_site=js_to_church_site_map[js_site[0]]&&js_to_church_site_map[js_site[0]][js_site[1]];if(church_site){church_sites.push(church_site)}}if(church_sites.length==0){throw err}else{var token=church_sites_to_tokens_map[church_sites[0]];var fntoken;if(token.text=="("){var tokStart=token.start,tokEnd=token.end,tokeNum;for(var j=0,jj=tokens.length;j<jj;j++){if(tokens[j].start==tokStart&&tokens[j].end==tokEnd){tokeNum=j}}fntoken=tokens[tokeNum+1]}var displayedMessage;if(msg[0]=="ReferenceError"){token=fntoken?fntoken:token;displayedMessage=token.text+" is not defined"}else if(msg[0]=="TypeError"){token=fntoken?fntoken:token;displayedMessage=token.text+" is not a function"}else{displayedMessage=err.message.replace("<<functionName>>",fntoken?fntoken.text:token.text)}var e=util.make_church_error(msg[0],token.start,token.end,displayedMessage);e.stack=church_sites.map(function(x){var tok=church_sites_to_tokens_map[x];return tok.start+"-"+tok.end}).join(",");e.stackarray=church_sites.map(function(x){return church_sites_to_tokens_map[x]});e.jsStack=stack;throw e}}return result}module.exports={evaluate:evaluate,format_result:util.format_result,churchToJs:churchToJs,churchToBareJs:churchToBareJs}}).call(this,require("/Users/timo/Documents/teaching/webchurch/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),typeof self!=="undefined"?self:typeof window!=="undefined"?window:{},require("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/evaluate.js","/");
